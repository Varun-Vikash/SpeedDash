<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jazz 1200 Ultimate</title>
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE RESET & BASICS --- */
        body { 
            font-family: 'Rajdhani', sans-serif; 
            background-color: #000; 
            overflow: hidden; 
            touch-action: none; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
        }

        /* --- VISIBILITY HELPERS --- */
        .hidden-force { display: none !important; }
        .pointer-events-none { pointer-events: none; }
        
        /* --- ANIMATIONS --- */
        .gauge-transition { transition: stroke-dashoffset 0.1s linear; }

        @keyframes introTextSequence { 
            0% { color: white; } 10% { color: #dc2626; } 20% { color: white; } 
            30% { color: white; } 40% { color: #dc2626; } 50% { color: white; } 100% { color: white; } 
        }
        .anim-text-strobe { animation: introTextSequence 0.8s steps(1) forwards; }

        @keyframes redPulse { 
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 
            70% { box-shadow: 0 0 0 2vmin rgba(220, 38, 38, 0); } 
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } 
        }
        .anim-pulse-red { animation: redPulse 1.5s infinite; }

        @keyframes ecoEnter { 
            0% { transform: translateY(50px) scale(0.9); opacity: 0; } 
            100% { transform: translateY(0) scale(1); opacity: 1; } 
        }
        .anim-eco-enter { animation: ecoEnter 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

        /* Scanlines Overlay */
        .scanlines {
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 0.5vmin;
            pointer-events: none; z-index: 99999; opacity: 0.3;
        }

        /* Specific Fonts & Backgrounds */
        .font-fl5 { font-family: 'Orbitron', sans-serif; letter-spacing: -0.05em; }
        .bg-fl5-pattern { background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 0l17.32 10v20L20 40 2.68 30V10z' fill-opacity='0.08' fill='%23333' stroke='%23444' stroke-width='1'/%3E%3C/svg%3E"); }
        .font-rounded { font-family: 'M PLUS Rounded 1c', sans-serif; }

        /* LEDs */
        .led { width: 100%; height: 100%; background: #333; skew-x: -20deg; border-radius: 2px; transition: background 0.05s, box-shadow 0.05s; }
        .led.green.on { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .led.yellow.on { background: #eab308; box-shadow: 0 0 10px #eab308; }
        .led.red.on { background: #ef4444; box-shadow: 0 0 15px #ef4444; }
        .led.blink { animation: flashWhite 0.1s infinite alternate; }
        @keyframes flashWhite { from { background: #ef4444; box-shadow: 0 0 15px #ef4444; } to { background: #ffffff; box-shadow: 0 0 20px #ffffff; } }

        .g-dot-smooth { transition: transform 0.2s cubic-bezier(0.1, 0.7, 1.0, 0.1); }
        .hand-smooth { transition: transform 0.1s cubic-bezier(0.4, 2.08, 0.55, 0.44); } 
        .hand-linear { transition: transform 0.1s linear; }

        /* SPOTIFY WIDGET */
        .spotify-card {
            background: rgba(24, 24, 27, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        .spotify-card:active { transform: scale(0.98); }
        .album-art-spin { animation: spinArt 10s linear infinite; }
        @keyframes spinArt { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .music-bar {
            height: 100%;
            background: #1db954;
            border-radius: 99px;
            width: 0%;
            transition: width 0.1s linear;
        }
    </style>
</head>
<body class="text-white h-screen w-full flex bg-zinc-950 relative overflow-hidden">

    <div class="absolute inset-0 scanlines pointer-events-none"></div>
    
    <!-- VIEW 0: INTRO SCREEN -->
    <div id="view-intro" class="fixed inset-0 z-[10000] flex flex-col items-center justify-center bg-black transition-opacity duration-300" style="display:flex; opacity:1;" onclick="handleIntroBgClick(event)">
        <div id="intro-watch-container" class="relative w-[65vmin] h-[65vmin] transition-all duration-300 cursor-pointer group hover:scale-105 active:scale-95 z-20 flex items-center justify-center" onclick="triggerStartButton(event)">
            <div class="w-full h-full rounded-full bg-zinc-900 shadow-2xl border-[0.4vmin] border-[#1a1a1a] relative overflow-hidden ring-[0.8vmin] ring-[#111]">
                <svg class="w-full h-full" viewBox="0 0 200 200">
                    <circle cx="100" cy="100" r="100" fill="#141414" />
                    <path d="M100 100 m-98 0 a 98 98 0 1 0 196 0 a 98 98 0 1 0 -196 0" fill="none" stroke="#050505" stroke-width="20" />
                    <g font-family="Arial" font-weight="bold" font-size="6" fill="#ccc" text-anchor="middle">
                        <text x="100" y="12" transform="rotate(0 100 100)">60</text>
                        <text x="135" y="20" transform="rotate(20 100 100) rotate(-20 135 20)">65</text>
                        <text x="175" y="55" transform="rotate(0 100 100)">75</text>
                        <text x="100" y="192" transform="rotate(0 100 100)">120</text>
                        <text x="25" y="45" transform="rotate(0 100 100)">500</text>
                    </g>
                    <circle cx="100" cy="100" r="78" fill="#18181b" />
                    <g stroke="#888" stroke-width="0.3"><circle cx="100" cy="100" r="76" fill="none" stroke="#555" stroke-width="0.5" /></g>
                    <g>
                        <rect x="97" y="28" width="2" height="12" fill="white" /><rect x="101" y="28" width="2" height="12" fill="white" />
                        <circle cx="98" cy="43" r="1" fill="#bbf7d0" /><circle cx="102" cy="43" r="1" fill="#bbf7d0" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(30 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(30 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(60 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(60 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(90 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(90 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(120 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(120 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(150 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(150 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(180 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(180 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(210 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(210 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(240 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(240 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(270 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(270 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(300 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(300 100 100)" />
                        <rect x="98.5" y="28" width="3" height="12" fill="white" transform="rotate(330 100 100)" /><rect x="99" y="30" width="1" height="8" fill="#bbf7d0" transform="rotate(330 100 100)" />
                    </g>
                    <text x="100" y="60" text-anchor="middle" fill="#ccc" font-family="serif" font-size="8" font-weight="bold">Ω</text>
                    <text x="100" y="66" text-anchor="middle" fill="#ccc" font-family="Arial" font-size="4" font-weight="bold" letter-spacing="0.5">OMEGA</text>
                    <text x="100" y="72" text-anchor="middle" fill="#ddd" font-family="Times New Roman" font-size="4" font-style="italic">Speedmaster</text>
                    <text x="100" y="76" text-anchor="middle" fill="#ddd" font-family="Arial" font-size="3">PROFESSIONAL</text>
                    <g transform="translate(62, 100)"><circle cx="0" cy="0" r="21" fill="#111" stroke="#333" stroke-width="0.2" /><line x1="0" y1="-18" x2="0" y2="-21" stroke="white" stroke-width="1" /><path id="intro-hand-sub-sec" d="M0 5 L0 -18" stroke="white" stroke-width="1" stroke-linecap="round" /></g>
                    <g transform="translate(138, 100)"><circle cx="0" cy="0" r="21" fill="#111" stroke="#333" stroke-width="0.2" /><line x1="0" y1="-18" x2="0" y2="-21" stroke="white" stroke-width="1" /><path id="intro-hand-sub-min" d="M0 5 L0 -18" stroke="white" stroke-width="1" stroke-linecap="round" /></g>
                    <g transform="translate(100, 138)"><circle cx="0" cy="0" r="21" fill="#111" stroke="#333" stroke-width="0.2" /><path id="intro-hand-sub-hour" d="M0 5 L0 -18" stroke="white" stroke-width="1" stroke-linecap="round" /></g>
                    <g id="intro-hand-main-hour" class="hand-linear"><path d="M-2.5 0 L-1.5 -55 L0 -62 L1.5 -55 L2.5 0 Z" fill="white" /><rect x="-0.8" y="-50" width="1.6" height="40" fill="#bbf7d0" /></g>
                    <g id="intro-hand-main-min" class="hand-linear"><path d="M-2 0 L-1.5 -75 L0 -82 L1.5 -75 L2 0 Z" fill="white" /><rect x="-0.8" y="-70" width="1.6" height="60" fill="#bbf7d0" /></g>
                    <g id="intro-hand-chrono" class="hand-smooth"><path d="M-2 25 L0 30 L2 25 L0 0 Z" fill="white" /> <line x1="0" y1="25" x2="0" y2="-95" stroke="white" stroke-width="0.6" /> <path d="M-3 -70 L3 -70 L0 -85 Z" fill="white" /> <circle cx="0" cy="0" r="2.5" fill="white" /></g>
                </svg>
                <div class="absolute inset-0 rounded-full bg-gradient-to-tr from-transparent via-white/5 to-transparent pointer-events-none"></div>
            </div>
            <div class="absolute -bottom-12 w-full text-center text-zinc-500 text-[1.5vmin] font-bold tracking-[0.3em] uppercase opacity-0 group-hover:opacity-100 transition-opacity">Tap to Unlock</div>
        </div>

        <div id="intro-start-btn" class="hidden absolute flex-col items-center justify-center z-30">
            <button onclick="startCar()" class="relative w-[35vmin] h-[35vmin] rounded-full bg-gradient-to-br from-red-600 to-red-900 border-4 border-zinc-800 shadow-[0_0_50px_rgba(220,38,38,0.5)] flex flex-col items-center justify-center group active:scale-95 transition-transform anim-pulse-red cursor-pointer">
                <div class="absolute inset-0 rounded-full border border-white/20"></div>
                <div class="absolute inset-1 rounded-full border border-black/30"></div>
                <div class="text-white font-bold text-[2.5vmin] tracking-widest uppercase mb-[0.5vmin]">Engine</div>
                <div class="text-white font-black text-[6vmin] tracking-tighter uppercase leading-none">Start</div>
                <div class="text-white font-bold text-[2.5vmin] tracking-widest uppercase mt-[0.5vmin]">Stop</div>
                <div class="w-[8vmin] h-[1vmin] bg-red-400 mt-[2vmin] rounded-full shadow-[0_0_10px_#f87171]"></div>
            </button>
            <div class="mt-[4vmin] text-zinc-600 text-[1.5vmin] font-bold tracking-widest uppercase animate-pulse">Tap background to cancel</div>
        </div>
    </div>

    <!-- SPORT INTRO FLASH -->
    <div id="sport-intro" class="fixed inset-0 z-[9000] flex flex-col items-center justify-center pointer-events-none hidden-force w-full overflow-hidden bg-black">
        <div class="text-center space-y-4 relative z-10 w-full px-4">
            <h1 id="intro-text" class="text-[15vmin] leading-none font-black italic text-white font-fl5 tracking-tighter">FULL SEND</h1>
            <div class="text-[4vmin] font-bold bg-white text-black px-6 py-2 skew-x-[-12deg] inline-block uppercase tracking-[0.3em]">+R MODE ACTIVE</div>
        </div>
    </div>

    <!-- VIEW 1: ECO DASHBOARD -->
    <div id="view-eco" class="absolute inset-0 flex flex-col landscape:flex-row z-10 transition-all duration-500 bg-zinc-950 opacity-0 pointer-events-none" onclick="handleEcoBgClick(event)">
        <div class="portrait:fixed portrait:bottom-0 portrait:w-full portrait:h-[12vh] landscape:static landscape:w-[8vw] landscape:h-full bg-zinc-950 portrait:border-t landscape:border-r border-zinc-900 flex portrait:flex-row landscape:flex-col items-center portrait:justify-around landscape:justify-between portrait:py-2 landscape:py-6 z-50 shadow-2xl shrink-0">
            <div class="landscape:space-y-10 portrait:flex portrait:gap-8 landscape:flex-col landscape:items-center">
                <div class="p-3 bg-zinc-900 rounded-xl border border-zinc-800"><div class="text-[4vmin] font-black tracking-tighter italic text-zinc-500">H</div></div>
                <i data-lucide="map-pin" class="text-zinc-500 w-[5vmin] h-[5vmin] md:w-[3vmin] md:h-[3vmin]"></i>
                <i data-lucide="gauge" class="text-white w-[5vmin] h-[5vmin] md:w-[3vmin] md:h-[3vmin]"></i>
                <div class="portrait:w-px portrait:h-8 landscape:w-10 landscape:h-px bg-zinc-800"></div>
                <i data-lucide="settings-2" class="text-zinc-500 w-[5vmin] h-[5vmin] md:w-[3vmin] md:h-[3vmin]"></i>
            </div>
            <div id="clock" class="text-xs text-zinc-600 font-bold font-mono portrait:hidden landscape:block">12:00</div>
        </div>

        <div class="flex-1 relative overflow-hidden flex flex-col portrait:mb-[12vh]">
            <div class="relative z-30 flex justify-between items-start p-4 md:p-6">
                <div class="flex flex-col">
                    <div class="flex items-center gap-2 text-zinc-500 mb-1">
                        <i data-lucide="map-pin" class="w-[3vmin] h-[3vmin]"></i>
                        <span id="weather-location" class="text-[2vmin] uppercase tracking-widest font-bold text-zinc-400 truncate max-w-[200px]">...</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2"><i id="weather-icon" data-lucide="cloud" class="w-[4vmin] h-[4vmin] text-zinc-400"></i><span id="weather-temp" class="text-[4vmin] font-bold text-white leading-none">--°</span></div>
                        <div class="w-px h-6 bg-zinc-800"></div>
                        <div class="flex items-center gap-2"><div id="eco-status-dot" class="w-2 h-2 rounded-full bg-zinc-600"></div><span id="eco-status-text" class="text-[1.5vmin] font-bold text-zinc-500 tracking-wide">NO GPS</span></div>
                    </div>
                </div>
                <div class="flex bg-zinc-900 p-1 rounded-lg border border-zinc-800 shadow-lg">
                    <button class="px-6 py-1 rounded-md text-[2vmin] font-bold uppercase tracking-wider transition-all bg-emerald-900/50 text-emerald-400 border border-emerald-500/30 cursor-default">Drive</button>
                    <button onclick="setMode('sport')" class="px-6 py-1 rounded-md text-[2vmin] font-bold uppercase tracking-wider transition-all text-zinc-500 hover:text-white hover:bg-zinc-800 relative z-50 cursor-pointer">Sport</button>
                </div>
            </div>

            <div class="relative z-20 flex-1 flex flex-col landscape:flex-row items-center justify-center portrait:gap-8 landscape:gap-[4vw] px-4 pb-12 w-full h-full">
                <div class="relative w-[30vmin] h-[30vmin] flex items-center justify-center portrait:order-2 landscape:order-1">
                    <svg class="w-full h-full transform rotate-[135deg]" viewBox="0 0 200 200">
                        <circle cx="100" cy="100" r="85" fill="none" stroke="#1f2937" stroke-width="12" stroke-dasharray="534" stroke-dashoffset="133.5" />
                        <circle id="eco-ring-rpm" cx="100" cy="100" r="85" fill="none" stroke="#10b981" stroke-width="12" stroke-dasharray="534" stroke-dashoffset="534" class="gauge-transition" />
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center mt-6">
                        <span id="eco-val-rpm" class="text-[6vmin] font-bold tracking-tighter text-white">0.0</span>
                        <span class="text-zinc-600 text-[1.5vmin] uppercase tracking-[0.3em] mt-2">x1000</span>
                    </div>
                </div>
                
                <div class="flex flex-col items-center portrait:w-full landscape:w-[30vh] portrait:space-y-4 landscape:space-y-6 relative portrait:order-1 landscape:order-2">
                    <div class="flex flex-col items-center">
                        <span id="eco-speed-val" class="text-[14vmin] font-bold text-white tracking-tighter leading-none" style="font-family: 'Orbitron', sans-serif;">0</span>
                        <span class="text-zinc-500 text-[1.5vmin] uppercase tracking-[0.4em]">KM/H</span>
                    </div>
                    
                    <!-- SPOTIFY WIDGET -->
                    <div id="spotify-widget" class="spotify-card w-[22vmin] h-[8vmin] rounded-[1.5vmin] flex items-center p-[1vmin] gap-[1.5vmin] z-50 cursor-pointer overflow-hidden relative" onclick="handleSpotifyClick()">
                         <div class="w-[6vmin] h-[6vmin] rounded-[1vmin] bg-zinc-800 flex items-center justify-center shrink-0 relative overflow-hidden">
                             <div class="absolute inset-0 bg-gradient-to-tr from-green-800 to-black opacity-60"></div>
                             <i data-lucide="music" class="w-[3vmin] h-[3vmin] text-green-500 album-art-spin z-10"></i>
                         </div>
                         <div class="flex flex-col justify-center flex-1 min-w-0">
                             <div id="sp-track" class="text-[1.5vmin] font-bold text-white truncate leading-tight">Connect Spotify</div>
                             <div id="sp-artist" class="text-[1.2vmin] font-medium text-gray-400 truncate">Tap to login</div>
                             <div class="w-full h-[0.4vmin] bg-white/10 rounded-full mt-[0.5vmin] overflow-hidden">
                                 <div id="sp-bar" class="music-bar"></div>
                             </div>
                         </div>
                         <div id="sp-controls" class="hidden gap-[0.5vmin] pr-[0.5vmin]">
                             <button onclick="spotifyPrev(event)" class="text-gray-400 hover:text-white"><i data-lucide="skip-back" class="w-[1.8vmin] h-[1.8vmin] fill-current"></i></button>
                             <button onclick="spotifyPlayPause(event)" class="text-white"><i id="sp-play-icon" data-lucide="pause" class="w-[1.8vmin] h-[1.8vmin] fill-current"></i></button>
                             <button onclick="spotifyNext(event)" class="text-gray-400 hover:text-white"><i data-lucide="skip-forward" class="w-[1.8vmin] h-[1.8vmin] fill-current"></i></button>
                         </div>
                    </div>

                    <button onclick="toggleGPS()" id="btn-gps-eco" class="w-full py-3 rounded bg-zinc-900 border border-zinc-800 text-zinc-400 font-bold text-[1.5vmin] uppercase tracking-[0.2em] transition-all hover:bg-zinc-800 hover:text-white flex items-center justify-center gap-2 cursor-pointer z-50 mt-[1vmin]">
                        <i data-lucide="satellite" class="w-3 h-3"></i> Enable GPS
                    </button>
                    <div id="debug-calc" onclick="toggleSpeedSource(event)" class="text-[1.2vmin] text-zinc-600 font-bold font-mono mt-2 cursor-pointer hover:text-zinc-400 transition-colors uppercase border border-zinc-800 px-2 py-1 rounded bg-black/20 truncate max-w-full">
                        MODE: AUTO
                    </div>
                </div>
                
                <div class="relative w-[30vmin] h-[30vmin] flex items-center justify-center portrait:order-3 landscape:order-3">
                    <div id="eco-watch-container" class="relative w-full h-full transition-all duration-500 cursor-pointer group hover:scale-105 active:scale-95 z-20" onclick="triggerStopButton(event)"></div>
                    <div id="eco-stop-btn" class="absolute inset-0 hidden flex-col items-center justify-center z-30">
                        <button onclick="stopCar()" class="relative w-[20vmin] h-[20vmin] rounded-full bg-gradient-to-br from-red-600 to-red-900 border-4 border-zinc-800 shadow-[0_0_50px_rgba(220,38,38,0.5)] flex flex-col items-center justify-center group active:scale-95 transition-transform anim-pulse-red cursor-pointer">
                            <div class="absolute inset-0 rounded-full border border-white/20"></div>
                            <div class="absolute inset-1 rounded-full border border-black/30"></div>
                            <div class="text-white font-bold text-[1.5vmin] tracking-widest uppercase mb-1">Engine</div>
                            <div class="text-white font-black text-[4vmin] tracking-tighter uppercase leading-none">STOP</div>
                            <div class="w-[5vmin] h-[0.5vmin] bg-red-400 mt-2 rounded-full shadow-[0_0_10px_#f87171]"></div>
                        </button>
                        <div class="mt-4 text-zinc-600 text-[1.2vmin] font-bold tracking-widest uppercase animate-pulse">Tap background to cancel</div>
                    </div>
                </div>
            </div>
            <div class="h-1 w-full bg-emerald-500 shadow-[0_0_20px_rgba(16,185,129,0.6
